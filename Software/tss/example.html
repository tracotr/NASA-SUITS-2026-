<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>TSS Telemetry Test Bench</title>
    <style>
        body { font-family: sans-serif; background: #1a1a1a; color: #eee; display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 10px; padding: 20px; }
        .card { border: 1px solid #444; padding: 15px; border-radius: 8px; background: #2a2a2a; }
        .status { font-weight: bold; margin-bottom: 10px; }
        .online { color: #00ff00; }
        .offline { color: #ff4444; }
        pre { background: #000; padding: 10px; overflow: auto; max-height: 200px; font-size: 12px; }
    </style>
</head>
<body>

    <div class="card" id="eva1-telemetry">
        <div class="status" id="eva1-telemetry-status">EVA1 Telemetry: Offline</div>
        <pre id="eva1-telemetry-data">Waiting for data...</pre>
    </div>

    <div class="card" id="rover-pr-telemetry">
        <div class="status" id="rover-pr-telemetry-status">Rover: Offline</div>
        <pre id="rover-pr-telemetry-data">Waiting for data...</pre>
    </div>

    <div class="card" id="ltv-location">
        <div class="status" id="ltv-location-status">LTV Location: Offline</div>
        <pre id="ltv-location-data">Waiting for data...</pre>
    </div>

    <script>
        const BASE_URL = "ws://localhost:8000/ws/";
        
        const categories = [
            "eva1:telemetry",
            "rover:pr_telemetry",
            "ltv:location"
        ];

        categories.forEach(category => {
            const socket = new WebSocket(BASE_URL + encodeURIComponent(category));
            
            // Replace : and _ with - for html, might not be necessary in javascript
            let elementId = category.replace(/[:_]/g, '-');

            // Get the status and data elements
            const statusElement = document.getElementById(`${elementId}-status`);
            const dataElement = document.getElementById(`${elementId}-data`);

            socket.onopen = () => {
                if (statusElement) {
                    statusElement.innerText = `${category}: Online`;
                    statusElement.className = "status online";
                }
            };

            socket.onmessage = (event) => {
                const data = JSON.parse(event.data);
                if (dataElement) {
                    dataElement.innerText = JSON.stringify(data, null, 2);
                }
            };

            socket.onclose = () => {
                if (statusElement) {
                    statusElement.innerText = `${category}: Offline`;
                    statusElement.className = "status offline";
                }
            };

            socket.onerror = (err) => {
                console.error(`Socket Error on ${category}:`, err);
            };
        });
    </script>
</body>
</html>